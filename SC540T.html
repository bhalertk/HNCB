<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta name='viewport' content='width=device-width, initial-scale=1.0, viewport-fit=cover'>
  <title>SC540T 驗證碼</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    html, body {
      height: 100%;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
      background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
      color: #fff;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 20px;
    }

    .container {
      background: rgba(255, 255, 255, 0.05);
      backdrop-filter: blur(10px);
      border-radius: 20px;
      padding: 30px 25px;
      max-width: 450px;
      width: 100%;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
      border: 1px solid rgba(255, 255, 255, 0.1);
    }

    h1 {
      font-size: 28px;
      margin-bottom: 30px;
      text-align: center;
      font-weight: 600;
      letter-spacing: 0.5px;
    }

    .form-group {
      margin-bottom: 20px;
    }

    label {
      display: block;
      margin-bottom: 8px;
      font-size: 14px;
      font-weight: 500;
      color: #e0e0e0;
    }

    input,
    select {
      width: 100%;
      padding: 12px 15px;
      border: 2px solid rgba(255, 255, 255, 0.2);
      border-radius: 10px;
      background: rgba(255, 255, 255, 0.1);
      color: #fff;
      font-size: 16px;
      transition: all 0.3s ease;
      font-family: inherit;
    }

    input::placeholder {
      color: rgba(255, 255, 255, 0.5);
    }

    input:focus,
    select:focus {
      outline: none;
      border-color: rgba(100, 200, 255, 0.8);
      background: rgba(255, 255, 255, 0.15);
      box-shadow: 0 0 0 3px rgba(100, 200, 255, 0.2);
    }

    select {
      cursor: pointer;
      appearance: none;
      background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='white' stroke-width='2'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
      background-repeat: no-repeat;
      background-position: right 10px center;
      background-size: 20px;
      padding-right: 40px;
    }

    /* 修正下拉選單選項的顯示 */
    select option {
      background-color: #16213e;
      color: #fff;
      padding: 10px;
    }

    select option:hover {
      background-color: #667eea;
      color: #fff;
    }

    select option:checked {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: #fff;
    }

    button {
      width: 100%;
      padding: 14px;
      margin-top: 10px;
      border: none;
      border-radius: 10px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      letter-spacing: 0.5px;
      text-transform: uppercase;
    }

    button:active {
      transform: scale(0.98);
    }

    button:hover {
      box-shadow: 0 8px 20px rgba(102, 126, 234, 0.4);
    }

    .result-box {
      margin-top: 25px;
      padding: 15px;
      background: rgba(100, 200, 255, 0.1);
      border: 2px solid rgba(100, 200, 255, 0.3);
      border-radius: 10px;
      text-align: center;
      display: none;
      min-height: 60px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .result-box.show {
      display: flex;
    }

    .result-code {
      font-size: 28px;
      font-weight: bold;
      color: #64c8ff;
      font-family: 'Courier New', monospace;
      letter-spacing: 2px;
    }

    .error-message {
      color: #ff6b6b;
      font-size: 13px;
      margin-top: 5px;
      display: none;
    }

    .error-message.show {
      display: block;
    }

    @media (max-width: 480px) {
      .container {
        padding: 25px 20px;
        border-radius: 16px;
      }

      h1 {
        font-size: 24px;
        margin-bottom: 25px;
      }

      label {
        font-size: 13px;
      }

      input,
      select {
        padding: 11px 12px;
        font-size: 16px;
      }

      button {
        padding: 13px;
        font-size: 15px;
      }

      .result-code {
        font-size: 24px;
      }
    }

    @media (max-width: 360px) {
      .container {
        padding: 20px 15px;
      }

      h1 {
        font-size: 20px;
        margin-bottom: 20px;
      }

      input,
      select {
        padding: 10px;
        font-size: 15px;
      }
    }
  </style>
</head>
<body>
<div class="container">
  <h1>SC540T 驗證碼</h1>

  <form id="cipherForm" onsubmit="cipher(event)">
    <div class="form-group">
      <label for="branch">分行代碼</label>
      <select id="branch" required>
        <option value="">請選擇分行</option>
        <option value="9010">9010</option>
        <option value="9020">9020</option>
        <option value="9030">9030</option>
        <option value="9050">9050</option>
        <option value="9070">9070</option>
        <option value="9090">9090</option>
        <option value="9100">9100</option>
        <option value="9130">9130</option>
        <option value="9140">9140</option>
        <option value="9180">9180</option>
      </select>
      <div class="error-message" id="branchError"></div>
    </div>

    <div class="form-group">
      <label for="tx_date">交易日期 (YYYYMMDD)</label>
      <input type="tel" id="tx_date" maxlength="8" inputmode="numeric" placeholder="例: 20260210" required>
      <div class="error-message" id="dateError"></div>
    </div>

    <div class="form-group">
      <label for="cid">Citrix ID <span style="font-size: 12px; color: #aaa;">(不需輸入HB)</span></label>
      <input type="tel" id="cid" value="" maxlength="5" inputmode="numeric" placeholder="例: 12345" required>
      <div class="error-message" id="cidError"></div>
    </div>

    <button type="submit">產生驗證碼</button>
  </form>

  <div class="result-box" id="resultBox">
    <div>
      <div style="font-size: 12px; margin-bottom: 8px; color: #aaa;">驗證碼</div>
      <div class="result-code" id="resultCode"></div>
    </div>
  </div>
</div>
<script type="text/javascript">
  // 初始化日期為今日
  function initializeDate() {
    var today = new Date();
    var tdm = today.getMonth() + 1;
    if (tdm.toString().length == 1) {
      tdm = "0" + tdm;
    }
    var tdd = today.getDate();
    if (tdd.toString().length == 1) {
      tdd = "0" + tdd;
    }
    var tdy = today.getFullYear();
    var td = "" + tdy + tdm + tdd;
    document.getElementById("tx_date").value = td;
  }

  // 清除所有錯誤消息
  function clearErrors() {
    document.getElementById('branchError').textContent = '';
    document.getElementById('branchError').classList.remove('show');
    document.getElementById('dateError').textContent = '';
    document.getElementById('dateError').classList.remove('show');
    document.getElementById('cidError').textContent = '';
    document.getElementById('cidError').classList.remove('show');
  }

  // 驗證表單並生成驗證碼
  function cipher(event) {
    event.preventDefault();
    clearErrors();

    var branch = document.getElementById('branch').value;
    var tx_date = document.getElementById('tx_date').value;
    var cid = document.getElementById('cid').value;

    var hasError = false;

    // 驗證分行代碼
    if (!branch) {
      document.getElementById('branchError').textContent = '請選擇分行代碼';
      document.getElementById('branchError').classList.add('show');
      hasError = true;
    }

    // 驗證交易日期
    if (tx_date.length != 8) {
      document.getElementById('dateError').textContent = '請輸入8位交易日期 (YYYYMMDD)';
      document.getElementById('dateError').classList.add('show');
      hasError = true;
    } else if (!/^\d{8}$/.test(tx_date)) {
      document.getElementById('dateError').textContent = '交易日期只能輸入數字';
      document.getElementById('dateError').classList.add('show');
      hasError = true;
    }

    // 驗證 Citrix ID
    if (cid.length < 4) {
      document.getElementById('cidError').textContent = '請輸入至少4位的Citrix ID';
      document.getElementById('cidError').classList.add('show');
      hasError = true;
    } else if (!/^\d{4,}$/.test(cid)) {
      document.getElementById('cidError').textContent = 'Citrix ID只能輸入數字';
      document.getElementById('cidError').classList.add('show');
      hasError = true;
    }

    if (hasError) {
      return;
    }

    // 原始算法（保持不變）
    if (branch == '9090') {
      cid = '11111';
    }

    cid = cid.substring(cid.length - 2, cid.length);
    var verifyCode = handle(branch) * handle(tx_date) * handle(cid);

    // 顯示結果
    document.getElementById('resultCode').textContent = verifyCode;
    document.getElementById('resultBox').classList.add('show');
  }

  // 計算每個字符的數字和
  function handle(st) {
    var i;
    var r = 0;
    for (i = 0; i < st.length; i++) {
      var parsed = parseInt(st[i]);
      if (isNaN(parsed)) {
        parsed = 0;
      }
      r += parsed;
    }
    return r;
  }

  // 頁面加載時初始化
  window.addEventListener('DOMContentLoaded', initializeDate);
</script>
</body>
</html>
